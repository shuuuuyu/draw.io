<?xml version="1.0" encoding="UTF-8"?>
<system_architecture>
  <project>
    <name>Trip Starter</name>
    <description>æ™ºæ…§æ—…éŠè¦åŠƒæ‡‰ç”¨ç³»çµ±</description>
    <version>1.0</version>
  </project>

  <!-- Layer 1: User Layer -->
  <layer id="1" name="ä½¿ç”¨è€…å±¤">
    <component id="user" type="user">
      <name>ä½¿ç”¨è€…</name>
      <icon>ğŸ‘¤</icon>
      <inputs>
        <input>æ—…éŠéœ€æ±‚è¼¸å…¥</input>
        <input>æª”æ¡ˆä¸Šå‚³</input>
        <input>åƒæ•¸è¨­å®š</input>
      </inputs>
      <outputs>
        <output>æŸ¥çœ‹è¡Œç¨‹çµæœ</output>
        <output>ä¸‹è¼‰ PDF æ–‡ä»¶</output>
        <output>ç€è¦½äº’å‹•åœ°åœ–</output>
      </outputs>
    </component>
  </layer>

  <!-- Layer 2: Frontend UI Layer -->
  <layer id="2" name="å‰ç«¯ä»‹é¢å±¤">
    <component id="gradio_interface" type="web_interface">
      <name>Gradio Web Interface</name>
      <icon>ğŸ–¥ï¸</icon>
      <technology>Gradio</technology>
      
      <tabs>
        <tab id="tab1">
          <name>æ—…éŠäººæ ¼æ¸¬é©—</name>
          <icon>ğŸ“‹</icon>
          <features>
            <feature>MBTI å•å·</feature>
            <feature>äººæ ¼åˆ†æ</feature>
            <feature>æ—…éŠå»ºè­°</feature>
          </features>
        </tab>
        
        <tab id="tab2">
          <name>è‡ªå‹•ç”Ÿæˆè¡Œç¨‹</name>
          <icon>âœ¨</icon>
          <features>
            <feature>ç›®çš„åœ°è¼¸å…¥</feature>
            <feature>æ—¥æœŸ/é ç®—è¨­å®š</feature>
            <feature>èˆˆè¶£é¸æ“‡</feature>
          </features>
        </tab>
        
        <tab id="tab3">
          <name>è¡Œç¨‹å„ªåŒ–å™¨</name>
          <icon>ğŸ”§</icon>
          <features>
            <feature>æª”æ¡ˆä¸Šå‚³</feature>
            <feature>ç¯€å¥èª¿æ•´</feature>
            <feature>é¢¨æ ¼é¸æ“‡</feature>
          </features>
        </tab>
        
        <tab id="tab4">
          <name>åœ°é»æ¨è–¦å™¨</name>
          <icon>ğŸ“</icon>
          <features>
            <feature>åœ°é»æœå°‹</feature>
            <feature>åŠå¾‘è¨­å®š</feature>
            <feature>é¡å‹ç¯©é¸</feature>
          </features>
        </tab>
      </tabs>
    </component>
  </layer>

  <!-- Layer 3: Core Logic Layer -->
  <layer id="3" name="æ ¸å¿ƒé‚è¼¯å±¤">
    <component id="core_logic" type="backend">
      <name>Python æ ¸å¿ƒè™•ç†æ¨¡çµ„</name>
      <icon>ğŸ§ </icon>
      <language>Python</language>
      
      <modules>
        <module id="generate_itinerary">
          <name>generate_itinerary()</name>
          <description>è¡Œç¨‹ç”Ÿæˆæ¨¡çµ„</description>
          <functions>
            <function>æ•´åˆå¤©æ°£ API è³‡æ–™</function>
            <function>æ•´åˆåŒ¯ç‡ API è³‡æ–™</function>
            <function>å‘¼å« Gemini AI</function>
            <function>ç”Ÿæˆ PDF</function>
          </functions>
          <dependencies>
            <dependency>Weather API</dependency>
            <dependency>Exchange API</dependency>
            <dependency>Gemini AI</dependency>
          </dependencies>
        </module>
        
        <module id="optimize_itinerary">
          <name>optimize_itinerary()</name>
          <description>è¡Œç¨‹å„ªåŒ–æ¨¡çµ„</description>
          <functions>
            <function>è®€å–ä¸Šå‚³æª”æ¡ˆ</function>
            <function>è§£æè¡Œç¨‹å…§å®¹</function>
            <function>AI å„ªåŒ–å»ºè­°</function>
            <function>ç”Ÿæˆ PDF</function>
          </functions>
          <dependencies>
            <dependency>Gemini AI</dependency>
          </dependencies>
        </module>
        
        <module id="recommend_places">
          <name>recommend_places()</name>
          <description>åœ°é»æ¨è–¦æ¨¡çµ„</description>
          <functions>
            <function>å‘¼å« SerpAPI</function>
            <function>è§£æåœ°é»è³‡æ–™</function>
            <function>AI åˆ†ææ¨è–¦</function>
            <function>ç”Ÿæˆäº’å‹•åœ°åœ–</function>
          </functions>
          <dependencies>
            <dependency>SerpAPI</dependency>
            <dependency>Gemini AI</dependency>
            <dependency>Folium</dependency>
          </dependencies>
        </module>
        
        <module id="create_pdf">
          <name>create_pdf_with_cn()</name>
          <description>PDF ç”Ÿæˆæ¨¡çµ„</description>
          <functions>
            <function>WeasyPrint è™•ç†</function>
            <function>ä¸­æ–‡å­—é«”æ”¯æ´</function>
            <function>HTML â†’ PDF è½‰æ›</function>
            <function>æ’ç‰ˆå„ªåŒ–</function>
          </functions>
          <technology>WeasyPrint</technology>
          <fonts>Noto Sans CJK</fonts>
        </module>
      </modules>
    </component>
  </layer>

  <!-- Layer 4: External API Layer -->
  <layer id="4" name="å¤–éƒ¨ API å±¤">
    <component id="weather_api" type="external_api">
      <name>Weather API</name>
      <icon>ğŸŒ¤ï¸</icon>
      <provider>Visual Crossing</provider>
      <features>
        <feature>15å¤©å¤©æ°£é å ±</feature>
        <feature>70å¹´æ­·å²è³‡æ–™</feature>
      </features>
      <quota>
        <limit>1000</limit>
        <period>day</period>
      </quota>
      <fallback>æ™ºæ…§é™ç´šæ©Ÿåˆ¶</fallback>
    </component>
    
    <component id="exchange_api" type="external_api">
      <name>Exchange API</name>
      <icon>ğŸ’±</icon>
      <provider>ExchangeRate-API</provider>
      <features>
        <feature>160+ è²¨å¹£æ”¯æ´</feature>
        <feature>å³æ™‚åŒ¯ç‡æŸ¥è©¢</feature>
      </features>
      <quota>
        <limit>1500</limit>
        <period>month</period>
      </quota>
      <fallback>é è¨­åŒ¯ç‡å€¼</fallback>
    </component>
    
    <component id="gemini_ai" type="external_api">
      <name>Gemini AI</name>
      <icon>ğŸ¤–</icon>
      <provider>Google Gemini</provider>
      <features>
        <feature>æ™ºæ…§è¡Œç¨‹ç”Ÿæˆ</feature>
        <feature>å…§å®¹å„ªåŒ–åˆ†æ</feature>
        <feature>åœ°é»æ¨è–¦åˆ†æ</feature>
      </features>
      <quota>
        <limit>1500</limit>
        <period>day</period>
      </quota>
      <required>true</required>
    </component>
    
    <component id="serpapi" type="external_api">
      <name>SerpAPI</name>
      <icon>ğŸ”</icon>
      <provider>SerpAPI</provider>
      <service>Google Maps Search</service>
      <features>
        <feature>åœ°é»æœå°‹</feature>
        <feature>è©•åˆ†è³‡è¨Š</feature>
        <feature>åœ°å€èˆ‡è·é›¢</feature>
      </features>
      <quota>
        <limit>100</limit>
        <period>month</period>
      </quota>
      <fallback>ç¯„ä¾‹è³‡æ–™</fallback>
    </component>
  </layer>

  <!-- Layer 5: Output Layer -->
  <layer id="5" name="è¼¸å‡ºå±¤">
    <component id="pdf_output" type="output">
      <name>PDF æ–‡ä»¶</name>
      <icon>ğŸ“„</icon>
      <format>PDF</format>
      <features>
        <feature>å®Œæ•´è¡Œç¨‹è¡¨</feature>
        <feature>ä¸­æ–‡å­—é«”æ”¯æ´</feature>
        <feature>å¯ä¸‹è¼‰ä¿å­˜</feature>
        <feature>å°ˆæ¥­æ’ç‰ˆ</feature>
      </features>
      <technology>WeasyPrint</technology>
    </component>
    
    <component id="table_output" type="output">
      <name>è³‡æ–™è¡¨æ ¼</name>
      <icon>ğŸ“Š</icon>
      <format>Dataframe</format>
      <features>
        <feature>åœ°é»æ¸…å–®</feature>
        <feature>è©•åˆ†æ’åº</feature>
        <feature>è·é›¢è³‡è¨Š</feature>
        <feature>äº’å‹•å¼é¡¯ç¤º</feature>
      </features>
      <technology>Gradio Dataframe</technology>
    </component>
    
    <component id="map_output" type="output">
      <name>äº’å‹•åœ°åœ–</name>
      <icon>ğŸ—ºï¸</icon>
      <format>HTML</format>
      <features>
        <feature>Folium åœ°åœ–æ•´åˆ</feature>
        <feature>æ¨™è¨˜å‰ä¸‰ååœ°é»</feature>
        <feature>å¯ç¸®æ”¾ç€è¦½</feature>
        <feature>å½ˆå‡ºè¦–çª—è³‡è¨Š</feature>
      </features>
      <technology>Folium</technology>
    </component>
  </layer>

  <!-- Data Flow Relationships -->
  <data_flow>
    <connection>
      <from>user</from>
      <to>gradio_interface</to>
      <type>user_input</type>
    </connection>
    
    <connection>
      <from>gradio_interface</from>
      <to>core_logic</to>
      <type>request</type>
    </connection>
    
    <connection>
      <from>generate_itinerary</from>
      <to>weather_api</to>
      <type>api_call</type>
    </connection>
    
    <connection>
      <from>generate_itinerary</from>
      <to>exchange_api</to>
      <type>api_call</type>
    </connection>
    
    <connection>
      <from>generate_itinerary</from>
      <to>gemini_ai</to>
      <type>api_call</type>
    </connection>
    
    <connection>
      <from>optimize_itinerary</from>
      <to>gemini_ai</to>
      <type>api_call</type>
    </connection>
    
    <connection>
      <from>recommend_places</from>
      <to>serpapi</to>
      <type>api_call</type>
    </connection>
    
    <connection>
      <from>recommend_places</from>
      <to>gemini_ai</to>
      <type>api_call</type>
    </connection>
    
    <connection>
      <from>core_logic</from>
      <to>pdf_output</to>
      <type>generate</type>
    </connection>
    
    <connection>
      <from>core_logic</from>
      <to>table_output</to>
      <type>generate</type>
    </connection>
    
    <connection>
      <from>core_logic</from>
      <to>map_output</to>
      <type>generate</type>
    </connection>
    
    <connection>
      <from>pdf_output</from>
      <to>user</to>
      <type>download</type>
    </connection>
    
    <connection>
      <from>table_output</from>
      <to>user</to>
      <type>display</type>
    </connection>
    
    <connection>
      <from>map_output</from>
      <to>user</to>
      <type>display</type>
    </connection>
  </data_flow>

  <!-- System Features -->
  <features>
    <feature id="1">
      <name>æ™ºæ…§é™ç´šæ©Ÿåˆ¶</name>
      <description>API å¤±æ•—æ™‚è‡ªå‹•ä½¿ç”¨é è¨­å€¼æˆ–å‚™ç”¨æ–¹æ¡ˆ</description>
    </feature>
    
    <feature id="2">
      <name>ä¸­æ–‡æ”¯æ´</name>
      <description>å®Œæ•´çš„ä¸­æ–‡å­—é«”å’Œç·¨ç¢¼æ”¯æ´</description>
    </feature>
    
    <feature id="3">
      <name>å¤š API æ•´åˆ</name>
      <description>æ•´åˆå››å€‹å¤–éƒ¨ API æä¾›è±å¯ŒåŠŸèƒ½</description>
    </feature>
    
    <feature id="4">
      <name>MBTI äººæ ¼åˆ†æ</name>
      <description>åŸºæ–¼æ—…éŠäººæ ¼é¡å‹æä¾›å€‹æ€§åŒ–å»ºè­°</description>
    </feature>
    
    <feature id="5">
      <name>å³æ™‚è³‡æ–™</name>
      <description>æä¾›å³æ™‚å¤©æ°£é å ±å’ŒåŒ¯ç‡è³‡è¨Š</description>
    </feature>
  </features>

  <!-- Technology Stack -->
  <technology_stack>
    <frontend>
      <framework>Gradio</framework>
      <visualization>Folium</visualization>
    </frontend>
    
    <backend>
      <language>Python 3</language>
      <libraries>
        <library>google-generativeai</library>
        <library>requests</library>
        <library>weasyprint</library>
        <library>pandas</library>
        <library>folium</library>
      </libraries>
    </backend>
    
    <external_services>
      <service>Google Gemini AI</service>
      <service>Visual Crossing Weather API</service>
      <service>ExchangeRate API</service>
      <service>SerpAPI</service>
    </external_services>
    
    <deployment>
      <platform>Google Colab</platform>
      <runtime>Python Runtime</runtime>
    </deployment>
  </technology_stack>

  <!-- API Configuration -->
  <api_configuration>
    <api name="gemini">
      <required>true</required>
      <secret_key>gemini</secret_key>
      <signup_url>https://aistudio.google.com/</signup_url>
    </api>
    
    <api name="weather_api">
      <required>false</required>
      <secret_key>weather_api</secret_key>
      <signup_url>https://www.visualcrossing.com/weather-api</signup_url>
    </api>
    
    <api name="exchange_api">
      <required>false</required>
      <secret_key>exchange_api</secret_key>
      <signup_url>https://www.exchangerate-api.com/</signup_url>
    </api>
    
    <api name="serpapi">
      <required>false</required>
      <secret_key>serpapi</secret_key>
      <signup_url>https://serpapi.com/</signup_url>
    </api>
  </api_configuration>

  <!-- Core Functions Summary -->
  <core_functions>
    <function name="æ—…éŠäººæ ¼æ¸¬é©—">
      <description>é€éå•å·åˆ†æä½¿ç”¨è€…çš„æ—…éŠåå¥½é¡å‹</description>
      <input>ä½¿ç”¨è€…å•å·å›ç­”</input>
      <output>æ—…éŠäººæ ¼é¡å‹èˆ‡å»ºè­°</output>
    </function>
    
    <function name="è‡ªå‹•ç”Ÿæˆè¡Œç¨‹">
      <description>æ ¹æ“šç›®çš„åœ°ã€æ—¥æœŸã€é ç®—å’Œèˆˆè¶£è‡ªå‹•ç”Ÿæˆå®Œæ•´è¡Œç¨‹</description>
      <input>åœ‹å®¶ã€åŸå¸‚ã€æ—¥æœŸã€å¤©æ•¸ã€é ç®—ã€èˆˆè¶£ã€æ—…éŠäººæ ¼</input>
      <output>è©³ç´°è¡Œç¨‹ã€å¤©æ°£é å ±ã€åŒ¯ç‡è³‡è¨Šã€PDF æ–‡ä»¶</output>
    </function>
    
    <function name="è¡Œç¨‹å„ªåŒ–">
      <description>å„ªåŒ–ç¾æœ‰è¡Œç¨‹ï¼Œèª¿æ•´ç¯€å¥èˆ‡é¢¨æ ¼</description>
      <input>è¡Œç¨‹æª”æ¡ˆã€ç¯€å¥é¸æ“‡ã€é¢¨æ ¼é¸æ“‡ã€é¡å¤–éœ€æ±‚</input>
      <output>å„ªåŒ–å¾Œè¡Œç¨‹ã€PDF æ–‡ä»¶</output>
    </function>
    
    <function name="åœ°é»æ¨è–¦">
      <description>æœå°‹ä¸¦æ¨è–¦æŒ‡å®šåœ°é»é™„è¿‘çš„æ™¯é»æˆ–é¤å»³</description>
      <input>åœ‹å®¶ã€åŸå¸‚ã€åœ°æ¨™ã€æœå°‹é¡å‹ã€æœå°‹åŠå¾‘</input>
      <output>åœ°é»åˆ—è¡¨ã€è©•åˆ†è³‡è¨Šã€AI æ¨è–¦ã€äº’å‹•åœ°åœ–</output>
    </function>
  </core_functions>

  <!-- System Metadata -->
  <metadata>
    <created_by>æ—æ›¸å¦¤ã€æ–½æ¨‚ç¦ã€è‘‰æš</created_by>
    <platform>Google Colab</platform>
    <ui_framework>Gradio</ui_framework>
    <primary_language>Python</primary_language>
    <supported_languages>ç¹é«”ä¸­æ–‡ã€English</supported_languages>
  </metadata>
</system_architecture>
